
<!DOCTYPE html>

<html lang="cs">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Landsat &#8212; Školení GRASS GIS pro pokročilé</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gismentors.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/translations.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Rejstřík" href="../genindex.html" />
    <link rel="search" title="Vyhledávání" href="../search.html" />
    <link rel="next" title="Zpracování lidarových dat" href="../lidar/index.html" />
    <link rel="prev" title="MODIS" href="modis.html" /> 
  </head><body>
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="../index.html">Školení GRASS GIS pro pokročilé</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="modis.html" title="MODIS"
             accesskey="P">předchozí</a> |
          <a href="../lidar/index.html" title="Zpracování lidarových dat"
             accesskey="N">další</a> |
          <a href="../genindex.html" title="Obecný rejstřík"
             accesskey="I">rejstřík</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="landsat">
<h1>Landsat<a class="headerlink" href="#landsat" title="Permalink to this heading">¶</a></h1>
<p>V této části si ukážeme především proces importu reálných dat do
systému GRASS, vytvoření časových značek a na jejich základě vytvoření
časoprostorového datasetu.</p>
<p>Jako vstupní data máme sadu snímků Landsat ve formátu TIFF. Ke každému
snímku je k dispozici maska, která definuje validního hodnoty. Maska obsahuje
hodnoty 1 a 2, přičemž hodnota 2 představuje oblačnost. Např.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gdalinfo<span class="w"> </span>lndcal.LT51920262011306KIS00_20111102.tif<span class="w"> </span>-mm
gdalinfo<span class="w"> </span>fmask.LT51920262011306KIS00_20111102.tif<span class="w"> </span>-noct<span class="w"> </span>-mm
</pre></div>
</div>
<p>Viz <a class="reference external" href="http://landsat.usgs.gov/landsat_climate_data_records_quality_calibration.php">Landsat Surface Reflectance Quality Assessment</a>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Existují užitečné utility, které usnadňují automatizované
stažení dat Landsat. Patří mezi ně např. <a class="reference external" href="https://pythonhosted.org/landsat-util/overview.html">landsat-util</a>,
<a class="reference external" href="http://krstn.eu/landsat-batch-download-from-google/">gsutil</a> nebo
<a class="reference external" href="https://olivierhagolle.github.io/LANDSAT-Download/">Landsat-Download</a>.</p>
</div>
<section id="import-vstupnich-dat">
<h2>Import vstupních dat<a class="headerlink" href="#import-vstupnich-dat" title="Permalink to this heading">¶</a></h2>
<p>V prvním kroku na základě vstupních dat vytvoříme novou lokaci:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>grass70<span class="w"> </span>-c<span class="w"> </span>lndcal.LT51920262011306KIS00_20111102.tif<span class="w"> </span>/opt/grassdata/landsat
</pre></div>
</div>
<p>Před importem můžeme zkontrolovat souřadnicový systém lokace:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>g.proj<span class="w"> </span>-p
</pre></div>
</div>
<p>Pro dávkový import a vytvoření časoprostorového datasetu si napíšeme
jednoduchý skript v jazyku Python, který provede následující kroky:</p>
<ol class="arabic simple">
<li><p>naimportuje data včetně masek <span class="lcode">18</span></p></li>
<li><p>aplikuje masky nad originalními daty <span class="lcode">34</span></p></li>
<li><p>nastaví časovou značku (datum je uvedeno jako součást názvu
souboru) <span class="lcode">59</span></p></li>
<li><p>maskované rastry zaregistruje do výstupního časoprostorového
datasetu <span class="lcode">73</span></p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="ch">#!/usr/bin/env python</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="c1">#%module</span>
<span class="linenos">  4</span><span class="c1">#% description: Creates temporal dataset from Landsat data.</span>
<span class="linenos">  5</span><span class="c1">#%end</span>
<span class="linenos">  6</span><span class="c1">#%option G_OPT_M_DIR</span>
<span class="linenos">  7</span><span class="c1">#% description: Name of directory with input Landsat files</span>
<span class="linenos">  8</span><span class="c1">#%end</span>
<span class="linenos">  9</span><span class="c1">#%option G_OPT_STRDS_OUTPUT</span>
<span class="linenos"> 10</span><span class="c1">#%end</span>
<span class="linenos"> 11</span>
<span class="linenos"> 12</span><span class="kn">import</span> <span class="nn">os</span>
<span class="linenos"> 13</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos"> 14</span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="linenos"> 15</span><span class="kn">import</span> <span class="nn">grass.script</span> <span class="k">as</span> <span class="nn">grass</span>
<span class="linenos"> 16</span><span class="kn">from</span> <span class="nn">grass.exceptions</span> <span class="kn">import</span> <span class="n">CalledModuleError</span>
<span class="linenos"> 17</span>
<span class="hll"><span class="linenos"> 18</span><span class="k">def</span> <span class="nf">import_data</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span class="linenos"> 19</span>    <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 20</span>    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
<span class="linenos"> 21</span>        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">):</span>
<span class="linenos"> 22</span>            <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="linenos"> 23</span>
<span class="linenos"> 24</span>    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
<span class="linenos"> 25</span>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 26</span>    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
<span class="linenos"> 27</span>        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 28</span>        <span class="n">grass</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s2">&quot;Importing &lt;</span><span class="si">{0}</span><span class="s2">&gt; (</span><span class="si">{1}</span><span class="s2">/</span><span class="si">{2}</span><span class="s2">)...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">count</span><span class="p">))</span>
<span class="linenos"> 29</span>        <span class="n">grass</span><span class="o">.</span><span class="n">percent</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="linenos"> 30</span>        <span class="n">grass</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s1">&#39;r.in.gdal&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span>
<span class="linenos"> 31</span>                          <span class="n">output</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 32</span>    <span class="n">grass</span><span class="o">.</span><span class="n">percent</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 33</span>    
<span class="hll"><span class="linenos"> 34</span><span class="k">def</span> <span class="nf">mask_data</span><span class="p">():</span>
</span><span class="linenos"> 35</span>    <span class="n">bands1</span> <span class="o">=</span> <span class="n">grass</span><span class="o">.</span><span class="n">list_grouped</span><span class="p">(</span><span class="s1">&#39;raster&#39;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;lndcal*.1$&#39;</span><span class="p">)[</span><span class="n">mapset</span><span class="p">]</span>
<span class="linenos"> 36</span>    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bands1</span><span class="p">)</span>
<span class="linenos"> 37</span>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 38</span>    <span class="k">for</span> <span class="n">b1</span> <span class="ow">in</span> <span class="n">bands1</span><span class="p">:</span>
<span class="linenos"> 39</span>        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 40</span>        <span class="n">oname</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos"> 41</span>        <span class="n">grass</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s2">&quot;Processing &lt;</span><span class="si">{0}</span><span class="s2">&gt; (</span><span class="si">{1}</span><span class="s2">/</span><span class="si">{2}</span><span class="s2">)...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">count</span><span class="p">))</span>
<span class="linenos"> 42</span>        <span class="n">grass</span><span class="o">.</span><span class="n">percent</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="linenos"> 43</span>        <span class="n">grass</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s1">&#39;g.region&#39;</span><span class="p">,</span> <span class="n">raster</span><span class="o">=</span><span class="n">b1</span><span class="p">)</span>
<span class="linenos"> 44</span>        <span class="n">mask</span> <span class="o">=</span> <span class="n">grass</span><span class="o">.</span><span class="n">find_file</span><span class="p">(</span><span class="s1">&#39;fmask.&#39;</span> <span class="o">+</span> <span class="n">oname</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s1">&#39;raster&#39;</span><span class="p">)[</span><span class="s1">&#39;fullname&#39;</span><span class="p">]</span>
<span class="linenos"> 45</span>        <span class="k">if</span> <span class="n">mask</span><span class="p">:</span>
<span class="linenos"> 46</span>            <span class="n">grass</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s1">&#39;r.mask&#39;</span><span class="p">,</span> <span class="n">raster</span><span class="o">=</span><span class="s1">&#39;fmask.&#39;</span> <span class="o">+</span> <span class="n">oname</span><span class="p">,</span> <span class="n">maskcats</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 47</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 48</span>            <span class="n">grass</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Mask missing for &lt;</span><span class="si">{0}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oname</span><span class="p">))</span>
<span class="linenos"> 49</span>        <span class="n">bands</span> <span class="o">=</span> <span class="n">grass</span><span class="o">.</span><span class="n">list_grouped</span><span class="p">(</span><span class="s1">&#39;raster&#39;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;lndcal.</span><span class="si">{0}</span><span class="s1">.*&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oname</span><span class="p">))[</span><span class="n">mapset</span><span class="p">]</span>
<span class="linenos"> 50</span>        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">:</span>
<span class="linenos"> 51</span>            <span class="n">n</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos"> 52</span>            <span class="n">grass</span><span class="o">.</span><span class="n">mapcalc</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">.</span><span class="si">{1}</span><span class="s1">=</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 53</span>        <span class="k">if</span> <span class="n">mask</span><span class="p">:</span>
<span class="linenos"> 54</span>            <span class="n">grass</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s1">&#39;r.mask&#39;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 55</span>        
<span class="linenos"> 56</span>    <span class="n">grass</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s1">&#39;g.remove&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;raster&#39;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;fmask*,lndcal*&#39;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 57</span>    <span class="n">grass</span><span class="o">.</span><span class="n">percent</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 58</span>    
<span class="hll"><span class="linenos"> 59</span><span class="k">def</span> <span class="nf">timestamp_data</span><span class="p">():</span>
</span><span class="linenos"> 60</span>    <span class="n">maps</span> <span class="o">=</span> <span class="n">grass</span><span class="o">.</span><span class="n">list_grouped</span><span class="p">(</span><span class="s1">&#39;raster&#39;</span><span class="p">)[</span><span class="n">mapset</span><span class="p">]</span>
<span class="linenos"> 61</span>    <span class="n">grass</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s2">&quot;Timestamping maps...&quot;</span><span class="p">)</span>
<span class="linenos"> 62</span>    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">maps</span><span class="p">)</span>
<span class="linenos"> 63</span>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 64</span>    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">maps</span><span class="p">:</span>
<span class="linenos"> 65</span>        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 66</span>        <span class="n">grass</span><span class="o">.</span><span class="n">percent</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="linenos"> 67</span>        <span class="n">date</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos"> 68</span>        <span class="n">grass_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> %b %Y&#39;</span><span class="p">)</span>
<span class="linenos"> 69</span>        <span class="n">grass</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s1">&#39;r.timestamp&#39;</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">grass_date</span><span class="p">)</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span>    <span class="n">grass</span><span class="o">.</span><span class="n">percent</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 72</span>
<span class="hll"><span class="linenos"> 73</span><span class="k">def</span> <span class="nf">create_strds</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
</span><span class="linenos"> 74</span>    <span class="n">grass</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s1">&#39;t.create&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
<span class="linenos"> 75</span>    <span class="n">map_file</span> <span class="o">=</span> <span class="n">grass</span><span class="o">.</span><span class="n">tempfile</span><span class="p">()</span>
<span class="linenos"> 76</span>    <span class="n">grass</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s1">&#39;g.list&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;raster&#39;</span><span class="p">,</span> <span class="n">mapset</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;newline&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">map_file</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 77</span>    <span class="n">grass</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s1">&#39;t.register&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">map_file</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;newline&#39;</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 78</span>
<span class="linenos"> 79</span><span class="k">def</span> <span class="nf">check_strds</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="linenos"> 80</span>    <span class="n">strds</span> <span class="o">=</span> <span class="n">grass</span><span class="o">.</span><span class="n">read_command</span><span class="p">(</span><span class="s1">&#39;t.list&#39;</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
<span class="linenos"> 81</span>    <span class="k">if</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;@&#39;</span> <span class="o">+</span> <span class="n">mapset</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">strds</span><span class="p">:</span>
<span class="linenos"> 82</span>        <span class="k">return</span>
<span class="linenos"> 83</span>    
<span class="linenos"> 84</span>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GRASS_OVERWRITE&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
<span class="linenos"> 85</span>        <span class="n">grass</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Space time raster dataset &lt;</span><span class="si">{}</span><span class="s2">&gt; is already exists &quot;</span>
<span class="linenos"> 86</span>                      <span class="s2">&quot;and will be overwritten.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<span class="linenos"> 87</span>        <span class="n">grass</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s1">&#39;t.remove&#39;</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 88</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 89</span>        <span class="n">grass</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;Space time raster dataset &lt;</span><span class="si">{}</span><span class="s2">&gt; is already in the database. &quot;</span>
<span class="linenos"> 90</span>                    <span class="s2">&quot;Use the overwrite flag.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<span class="linenos"> 91</span>    
<span class="linenos"> 92</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="linenos"> 93</span>    <span class="n">check_strds</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">])</span>
<span class="linenos"> 94</span>    <span class="n">import_data</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">])</span>
<span class="linenos"> 95</span>    <span class="n">mask_data</span><span class="p">()</span>
<span class="linenos"> 96</span>    <span class="n">timestamp_data</span><span class="p">()</span>
<span class="linenos"> 97</span>    <span class="n">create_strds</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">])</span>
<span class="linenos"> 98</span>    
<span class="linenos"> 99</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">100</span>    <span class="n">opt</span><span class="p">,</span> <span class="n">flgs</span> <span class="o">=</span> <span class="n">grass</span><span class="o">.</span><span class="n">parser</span><span class="p">()</span>
<span class="linenos">101</span>    <span class="n">mapset</span><span class="o">=</span><span class="n">grass</span><span class="o">.</span><span class="n">gisenv</span><span class="p">()[</span><span class="s1">&#39;MAPSET&#39;</span><span class="p">]</span>
<span class="linenos">102</span>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>Skript je ke stažení <a class="reference external" href="../_static/skripty/tgrass_landsat.py">zde</a>. Příklad spuštění:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>grass_landsat.py<span class="w"> </span><span class="nv">input</span><span class="o">=</span>~/geodata/sub101<span class="w"> </span><span class="nv">out</span><span class="o">=</span>landsat
</pre></div>
</div>
<p>Ve výsledném datasetu máme zaregistrována data od roku 1984 do 2014:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>t.info<span class="w"> </span>landsat

...
<span class="p">|</span><span class="w"> </span>Start<span class="w"> </span>time:.................<span class="w"> </span><span class="m">1984</span>-06-25<span class="w"> </span><span class="m">00</span>:00:00
<span class="p">|</span><span class="w"> </span>End<span class="w"> </span>time:...................<span class="w"> </span><span class="m">2014</span>-12-29<span class="w"> </span><span class="m">00</span>:00:00
...
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Vylepšená verze skriptu s podporou pro multiprocessing je ke
stažení <a class="reference external" href="../_static/skripty/tgrass_landsat_foss4g2016.py">zde</a>.</p>
</div>
</section>
<section id="detektce-vodni-ploch-v-casove-rade">
<h2>Detektce vodní ploch v časové řadě<a class="headerlink" href="#detektce-vodni-ploch-v-casove-rade" title="Permalink to this heading">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>t.rast.extract<span class="w"> </span><span class="nv">input</span><span class="o">=</span>landsat<span class="w"> </span><span class="nv">where</span><span class="o">=</span><span class="s2">&quot;name like &#39;%_B2&#39;&quot;</span><span class="w"> </span><span class="nv">output</span><span class="o">=</span>landsat_b2
t.rast.extract<span class="w"> </span><span class="nv">input</span><span class="o">=</span>landsat<span class="w"> </span><span class="nv">where</span><span class="o">=</span><span class="s2">&quot;name like &#39;%_B5&#39;&quot;</span><span class="w"> </span><span class="nv">output</span><span class="o">=</span>landsat_b5

t.rast.mapcalc<span class="w"> </span><span class="nv">inputs</span><span class="o">=</span>landsat_b2,landsat_b5
<span class="w"> </span><span class="nv">expression</span><span class="o">=</span><span class="s2">&quot;float(landsat_b2 - landsat_b5) / (landsat_b2 + landsat_b5) &gt; 0&quot;</span>
<span class="w"> </span><span class="nv">output</span><span class="o">=</span>landsat_voda<span class="w"> </span><span class="nv">basename</span><span class="o">=</span>voda
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          
          <h3>Table of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../skripty/index.html">Úvod do skriptování</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pygrass/index.html">PyGRASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pywps/index.html">Publikování WPS procesu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hydrologie/index.html">Hydrologie</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Časoprostorové analýzy</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="modis.html">MODIS</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Landsat</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../lidar/index.html">Zpracování lidarových dat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zod/index.html">Zpracování obrazových dat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../formaty/index.html">Práce s externími formáty</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3d/index.html">3D</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Vyhledávání</h3>
            <form class="search" action="../search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="OK" />
            </form>
          </div>

        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="modis.html" title="MODIS"
              >předchozí</a> |
            <a href="../lidar/index.html" title="Zpracování lidarových dat"
              >další</a> |
            <a href="../genindex.html" title="Obecný rejstřík"
              >rejstřík</a>
          </div>
          <div role="note" aria-label="source link">
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014-2023 GISMentors.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>